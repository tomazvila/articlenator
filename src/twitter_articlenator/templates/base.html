<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Twitter Article to PDF{% endblock %}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“„</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“„</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/bookmarks">Bookmarks</a>
            <a href="/setup">Setup</a>
            <span id="cookie-status" class="cookie-status" title="Checking cookie status...">
                <span class="status-dot"></span>
                <span class="status-text">Checking...</span>
            </span>
        </nav>
    </header>
    <script>
    // Shared cookie status key
    const COOKIES_KEY = 'articlenator_cookies';

    // Update nav cookie status from localStorage
    function updateNavCookieStatus() {
        const statusEl = document.getElementById('cookie-status');
        const dotEl = statusEl.querySelector('.status-dot');
        const textEl = statusEl.querySelector('.status-text');

        // Remove all status classes
        statusEl.classList.remove('loading', 'not-configured', 'configured', 'working', 'invalid', 'error');

        const cookies = localStorage.getItem(COOKIES_KEY);

        if (!cookies || !cookies.trim()) {
            statusEl.classList.add('not-configured');
            statusEl.title = 'Twitter cookies not configured';
            textEl.textContent = 'No cookies';
            return;
        }

        // Quick client-side validation: check for auth_token and ct0
        const hasAuthToken = cookies.includes('auth_token') && cookies.match(/auth_token[=\s]\S{20,}/);
        const hasCt0 = cookies.includes('ct0') && cookies.match(/ct0[=\s]\S{20,}/);

        if (hasAuthToken && hasCt0) {
            statusEl.classList.add('configured');
            statusEl.title = 'Cookies configured (go to Setup to test)';
            textEl.textContent = 'Cookies set';
        } else {
            statusEl.classList.add('invalid');
            statusEl.title = 'Cookies incomplete - missing required values';
            textEl.textContent = 'Invalid';
        }
    }

    // Run on page load
    updateNavCookieStatus();
    </script>
    <main>
        {% block content %}{% endblock %}
    </main>
    <footer>
        <p>Twitter Article to PDF Converter by LilVilla</p>
        <p class="version">{{ app_version }}</p>
    </footer>
</body>
</html>
